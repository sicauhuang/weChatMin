<view class="car-form-page">
  <!-- 加载状态 -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 表单内容 -->
  <scroll-view class="form-container" scroll-y="true" enhanced="true">
    <!-- 基本信息 -->
    <view class="form-section">
      <view class="section-title">
        <text class="section-title__text">基本信息</text>
        <text class="section-title__required">*必填</text>
      </view>

      <!-- 车型选择 -->
      <view class="form-item">
        <view class="form-item__label">
          <text class="form-item__label-text">车型</text>
          <text class="form-item__required">*</text>
        </view>
        <picker 
          class="form-item__picker" 
          mode="selector" 
          range="{{carModels}}" 
          value="{{carModelIndex}}"
          bindchange="onCarModelChange">
          <view class="picker-display {{carModelIndex === -1 ? 'placeholder' : ''}}">
            <text class="picker-text">{{carModelIndex === -1 ? '请选择车型' : carModels[carModelIndex]}}</text>
            <text class="iconfont icon-arrow-down picker-arrow"></text>
          </view>
        </picker>
        <text class="form-item__error" wx:if="{{errors.carModel}}">{{errors.carModel}}</text>
      </view>

      <!-- 车牌号 -->
      <view class="form-item">
        <view class="form-item__label">
          <text class="form-item__label-text">车牌号</text>
          <text class="form-item__required">*</text>
        </view>
        <input 
          class="form-item__input"
          placeholder="请输入车牌号"
          value="{{formData.licensePlate}}"
          data-field="licensePlate"
          bindinput="onInputChange" />
        <text class="form-item__error" wx:if="{{errors.licensePlate}}">{{errors.licensePlate}}</text>
      </view>

      <!-- 售价 -->
      <view class="form-item">
        <view class="form-item__label">
          <text class="form-item__label-text">售价（万元）</text>
          <text class="form-item__required">*</text>
        </view>
        <input 
          class="form-item__input"
          placeholder="请输入售价"
          type="digit"
          value="{{formData.price}}"
          data-field="price"
          bindinput="onInputChange" />
        <text class="form-item__error" wx:if="{{errors.price}}">{{errors.price}}</text>
      </view>

      <!-- 车辆状况 -->
      <view class="form-item">
        <view class="form-item__label">
          <text class="form-item__label-text">车辆状况</text>
          <text class="form-item__required">*</text>
        </view>
        <picker 
          class="form-item__picker" 
          mode="selector" 
          range="{{conditions}}" 
          value="{{conditionIndex}}"
          bindchange="onConditionChange">
          <view class="picker-display {{conditionIndex === -1 ? 'placeholder' : ''}}">
            <text class="picker-text">{{conditionIndex === -1 ? '请选择车辆状况' : conditions[conditionIndex]}}</text>
            <text class="iconfont icon-arrow-down picker-arrow"></text>
          </view>
        </picker>
        <text class="form-item__error" wx:if="{{errors.condition}}">{{errors.condition}}</text>
      </view>

      <!-- 所在地区 -->
      <view class="form-item">
        <view class="form-item__label">
          <text class="form-item__label-text">所在地区</text>
          <text class="form-item__required">*</text>
        </view>
        <picker 
          class="form-item__picker" 
          mode="selector" 
          range="{{locations}}" 
          value="{{locationIndex}}"
          bindchange="onLocationChange">
          <view class="picker-display {{locationIndex === -1 ? 'placeholder' : ''}}">
            <text class="picker-text">{{locationIndex === -1 ? '请选择所在地区' : locations[locationIndex]}}</text>
            <text class="iconfont icon-arrow-down picker-arrow"></text>
          </view>
        </picker>
        <text class="form-item__error" wx:if="{{errors.location}}">{{errors.location}}</text>
      </view>
    </view>

    <!-- 联系信息 -->
    <view class="form-section">
      <view class="section-title">
        <text class="section-title__text">联系信息</text>
      </view>

      <!-- 车主姓名 -->
      <view class="form-item">
        <view class="form-item__label">
          <text class="form-item__label-text">车主姓名</text>
          <text class="form-item__required">*</text>
        </view>
        <input 
          class="form-item__input"
          placeholder="请输入车主姓名"
          value="{{formData.ownerName}}"
          data-field="ownerName"
          bindinput="onInputChange" />
        <text class="form-item__error" wx:if="{{errors.ownerName}}">{{errors.ownerName}}</text>
      </view>

      <!-- 联系电话 -->
      <view class="form-item">
        <view class="form-item__label">
          <text class="form-item__label-text">联系电话</text>
          <text class="form-item__required">*</text>
        </view>
        <input 
          class="form-item__input"
          placeholder="请输入联系电话"
          type="number"
          value="{{formData.contactPhone}}"
          data-field="contactPhone"
          bindinput="onInputChange" />
        <text class="form-item__error" wx:if="{{errors.contactPhone}}">{{errors.contactPhone}}</text>
      </view>
    </view>

    <!-- 车辆照片 -->
    <view class="form-section">
      <view class="section-title">
        <text class="section-title__text">车辆照片</text>
        <text class="section-title__subtitle">最多可上传9张</text>
      </view>

      <view class="image-upload">
        <!-- 已上传的图片 -->
        <view 
          class="image-upload__item"
          wx:for="{{formData.images}}"
          wx:key="index">
          <image 
            class="image-upload__image"
            src="{{item}}"
            mode="aspectFill"
            data-url="{{item}}"
            bindtap="onImagePreview" />
          <view 
            class="image-upload__delete"
            data-index="{{index}}"
            bindtap="onImageDelete">
            <text class="iconfont icon-guanbi image-upload__delete-icon"></text>
          </view>
        </view>

        <!-- 上传按钮 -->
        <view 
          class="image-upload__add"
          wx:if="{{formData.images.length < 9}}"
          bindtap="onImageUpload">
          <text class="iconfont icon-tianjia image-upload__add-icon"></text>
          <text class="image-upload__add-text">添加照片</text>
        </view>
      </view>
    </view>

    <!-- 车辆描述 -->
    <view class="form-section">
      <view class="section-title">
        <text class="section-title__text">车辆描述</text>
        <text class="section-title__subtitle">选填</text>
      </view>

      <view class="form-item">
        <textarea 
          class="form-item__textarea"
          placeholder="请输入车辆详细描述，如保养记录、事故情况等..."
          value="{{formData.description}}"
          data-field="description"
          bindinput="onInputChange"
          maxlength="500"
          auto-height />
      </view>
    </view>

    <!-- 占位空间 -->
    <view class="form-spacer"></view>
  </scroll-view>

  <!-- 底部操作按钮 -->
  <view class="form-actions">
    <button 
      class="form-actions__button form-actions__button--secondary"
      bindtap="onCancel">
      取消
    </button>
    <button 
      class="form-actions__button form-actions__button--primary"
      bindtap="onSave"
      loading="{{submitting}}">
      {{mode === 'edit' ? '更新' : '保存'}}
    </button>
  </view>
</view>