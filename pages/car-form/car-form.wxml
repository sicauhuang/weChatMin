<view class="car-form-page">
  <!-- 加载状态 -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <text class="loading-text">加载中...</text>
  </view>

  <!-- 表单内容 -->
  <scroll-view
    class="form-container"
    scroll-y
    enhanced="true"
    scroll-top="{{scrollTop}}"
    scroll-with-animation="true">
    <!-- 车辆信息 -->
    <van-cell-group title="车辆信息" border="{{false}}">
      <!-- 车辆名称 -->
      <van-field
        value="{{formData.carName}}"
        placeholder="请输入"
        label="车辆名称"
        border="{{false}}"
        data-field="carName"
        bind:change="onInputChange" />

      <!-- 品牌车型 -->
      <van-cell
        title="品牌车型"
        value="{{formData.brandModel || '请选择车型'}}"
        is-link
        required
        class="car-brandModel"
        bind:click="showVehiclePicker"
        arrow-direction="down" />

      <!-- 车龄 -->
      <van-field
        value="{{formData.carAge}}"
        placeholder="请输入"
        label="车龄"
        type="number"
        required
        border="{{false}}"
        data-field="carAge"
        bind:change="onInputChange"
        use-button-slot
      >
        <view slot="button" class="field-unit">年</view>
      </van-field>

      <!-- 车辆颜色 -->
      <van-field
        value="{{formData.color}}"
        placeholder="请输入"
        label="车辆颜色"
        required
        border="{{false}}"
        data-field="color"
        bind:change="onInputChange" />

      <!-- 里程数 -->
      <van-field
        value="{{formData.mileage}}"
        placeholder="请输入"
        label="里程数"
        type="digit"
        required
        border="{{false}}"
        data-field="mileage"
        bind:change="onInputChange"
        use-button-slot
      >
        <view slot="button" class="field-unit">万公里</view>
      </van-field>

      <!-- 过户次数 -->
      <van-field
        value="{{formData.transferCount}}"
        placeholder="请输入"
        label="过户次数"
        type="number"
        required
        border="{{false}}"
        data-field="transferCount"
        bind:change="onInputChange" />

      <!-- 上牌日期 -->
      <van-cell
        title="上牌日期"
        value="{{formData.plateDate || '请选择'}}"
        is-link
        required
        class="car-plateDate"
        bind:click="showDatePicker"
        arrow-direction="down" />

      <!-- 上牌城市 -->
      <van-field
        value="{{formData.plateCity}}"
        placeholder="请输入"
        label="上牌城市"
        required
        border="{{false}}"
        data-field="plateCity"
        bind:change="onInputChange" />

      <!-- 使用性质 -->
      <van-field
        value="{{formData.usageType}}"
        placeholder="请输入"
        label="使用性质"
        required
        border="{{false}}"
        data-field="usageType"
        bind:change="onInputChange" />

      <!-- 车况描述 -->
      <van-field
        value="{{formData.condition}}"
        placeholder="请描述车辆状况，如保养记录、事故情况等..."
        label="车况描述"
        type="textarea"
        autosize
        maxlength="200"
        show-word-limit
        border="{{false}}"
        data-field="condition"
        bind:change="onInputChange" />

      <!-- 加装项目 -->
      <van-field
        value="{{formData.modifications}}"
        placeholder="请描述加装的项目，如导航、倒车雷达等..."
        label="加装项目"
        type="textarea"
        autosize
        maxlength="200"
        show-word-limit
        border="{{false}}"
        data-field="modifications"
        bind:change="onInputChange" />
    </van-cell-group>

    <!-- 售卖信息 -->
    <van-cell-group title="售卖信息" border="{{false}}">
      <!-- 底价 -->
      <van-field
        value="{{formData.lowPrice}}"
        placeholder="请输入"
        label="底价"
        type="digit"
        required
        border="{{false}}"
        data-field="lowPrice"
        bind:change="onInputChange"
        use-button-slot
      >
        <view slot="button" class="field-unit">万元</view>
      </van-field>

      <!-- 售价 -->
      <van-field
        value="{{formData.sellPrice}}"
        placeholder="请输入"
        label="售价"
        type="digit"
        required
        border="{{false}}"
        data-field="sellPrice"
        bind:change="onInputChange"
        use-button-slot
      >
        <view slot="button" class="field-unit">万元</view>
      </van-field>

      <!-- 联系方式 -->
      <van-field
        value="{{formData.contactInfo}}"
        placeholder="请输入"
        label="联系方式"
        type="number"
        required
        border="{{false}}"
        data-field="contactInfo"
        bind:change="onInputChange" />
    </van-cell-group>

    <!-- 车辆照片 -->
    <van-cell-group title="车辆照片（最多5张）" border="{{false}}">
      <van-cell>
        <van-uploader
          file-list="{{imageList}}"
          bind:after-read="onImageUpload"
          bind:delete="onImageDelete"
          max-count="5"
          preview-size="180rpx"
          upload-text="添加照片" />
      </van-cell>
    </van-cell-group>

    <!-- 占位空间 -->
    <view style="height: 140rpx;"></view>
  </scroll-view>

  <!-- 底部提交按钮 -->
  <view class="form-actions">
    <van-button
      type="primary"
      size="large"
      loading="{{submitting}}"
      custom-class="submit-button"
      bind:click="onSave">
      {{mode === 'edit' ? '更新' : '保存'}}
    </van-button>
  </view>

  <!-- Vant 选择器弹窗 -->


  <!-- 日期选择器 -->
  <van-popup show="{{showDatePopup}}" position="bottom" bind:close="hideDatePicker">
    <van-datetime-picker
      type="date"
      value="{{currentDate}}"
      bind:confirm="onDateConfirm"
      bind:cancel="hideDatePicker" />
  </van-popup>

  <!-- 车型选择器 -->
  <vehicle-picker
    show="{{showVehiclePicker}}"
    title="选择车型"
    bind:onConfirm="onVehicleConfirm"
    bind:onCancel="onVehicleCancel"
    bind:onClose="hideVehiclePicker" />

  <!-- Toast 组件 -->
  <van-toast id="van-toast" />
</view>