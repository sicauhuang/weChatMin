<view class="profile-page">
  <!-- 渐变背景层（绝对定位，不占据文档流） -->
  <view class="profile-page__background"></view>

  <!-- 内容区域 -->
  <view class="profile-page__content">
    <!-- 用户信息卡片 -->
    <view class="profile-page__user-card">
      <view class="user-card" bindtap="onUserCardTap">
        <!-- 用户头像 -->
        <view class="user-card__avatar">
          <image class="user-card__avatar-image" src="{{avatarUrl}}" mode="aspectFill"></image>
        </view>

        <!-- 用户信息 -->
        <view class="user-card__info">
          <text class="user-card__nickname">{{nickname}}</text>
          <text class="user-card__identity">{{identity}}</text>
        </view>

        <!-- 设置按钮 - 右上角悬浮，仅登录时显示 -->
        <view class="user-card__settings" wx:if="{{isLogin}}" bindtap="onSettingsTap">
          <text class="iconfont icon-shezhi user-card__settings-icon"></text>
        </view>
      </view>
    </view>

    <!-- 我的足迹和我的收藏 - 独立并排卡片 -->
    <view class="profile-page__quick-actions">
      <view class="quick-actions">
        <view class="quick-actions__item" bindtap="onFootprintsTap">
          <text class="iconfont icon-zuji quick-actions__icon"></text>
          <text class="quick-actions__text">我的足迹</text>
        </view>
        <view class="quick-actions__item" bindtap="onFavoritesTap">
          <text class="iconfont icon-shoucang quick-actions__icon"></text>
          <text class="quick-actions__text">我的收藏</text>
        </view>
      </view>
    </view>

    <!-- 功能模块区域 -->
    <view class="profile-page__function-modules">
      <view class="function-modules">
    <permission-wrapper permission="miniprogram:page.teach">
        <!-- 我的二维码 -->
        <view class="function-modules__item"
              bindtap="onFunctionModuleTap"
              data-id="qrcode"
              data-name="我的二维码">
          <view class="function-modules__item-left">
            <text class="iconfont icon-erweima function-modules__item-icon"></text>
            <text class="function-modules__item-name">我的二维码</text>
          </view>
          <view class="function-modules__item-right">
            <text class="function-modules__item-arrow">></text>
          </view>
        </view>
        </permission-wrapper>

        <!-- 我要卖车 -->
        <permission-wrapper permission="miniprogram:page.sell">
          <view class="function-modules__item"
                bindtap="onFunctionModuleTap"
                data-id="buy-car"
                data-name="我要卖车">
            <view class="function-modules__item-left">
              <text class="iconfont icon-maiche function-modules__item-icon"></text>
              <text class="function-modules__item-name">我要卖车</text>
            </view>
            <view class="function-modules__item-right">
              <text class="function-modules__item-arrow">></text>
            </view>
          </view>
        </permission-wrapper>

        <!-- 审批车辆 -->
        <permission-wrapper permission="miniprogram:page.approve">
          <view class="function-modules__item"
                bindtap="onFunctionModuleTap"
                data-id="approve-car"
                data-name="审批车辆">
            <view class="function-modules__item-left">
              <text class="iconfont icon-shenpi function-modules__item-icon"></text>
              <text class="function-modules__item-name">审批车辆</text>
            </view>
            <view class="function-modules__item-right">
              <text class="function-modules__item-arrow">></text>
            </view>
          </view>
        </permission-wrapper>

     <!-- 模拟票核销 -->
        <permission-wrapper permission="miniprogram:page.check">
          <view class="function-modules__item"
                bindtap="onFunctionModuleTap"
                data-id="verify-ticket"
                data-name="模拟票核销">
            <view class="function-modules__item-left">
              <text class="iconfont icon-saoma function-modules__item-icon"></text>
              <text class="function-modules__item-name">模拟票核销</text>
            </view>
            <view class="function-modules__item-right">
              <text class="function-modules__item-arrow">></text>
            </view>
          </view>
        </permission-wrapper>

          <!-- 模拟票助考 -->
        <permission-wrapper permission="miniprogram:page.teach">
          <view class="function-modules__item"
                bindtap="onFunctionModuleTap"
                data-id="assist-exam"
                data-name="模拟票助考">
            <view class="function-modules__item-left">
              <text class="iconfont icon-zhukao function-modules__item-icon"></text>
              <text class="function-modules__item-name">模拟票助考</text>
            </view>
            <view class="function-modules__item-right">
              <text class="function-modules__item-arrow">></text>
            </view>
          </view>
        </permission-wrapper>

      </view>
    </view>
  </view>

  <!-- 自定义操作弹窗 -->
  <view class="action-modal" wx:if="{{showActionModal}}" bindtap="onCloseActionModal">
    <view class="action-modal__mask"></view>
    <view class="action-modal__content" bindtap="onActionModalContentTap">
      <view class="action-modal__body">
        <view class="action-modal__button action-modal__button--danger" bindtap="onCancelAccountTap">
          <text class="action-modal__button-text">注销账号</text>
        </view>
        <view class="action-modal__button action-modal__button--normal" bindtap="onLogoutTap">
          <text class="action-modal__button-text">退出登录</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 用户二维码弹窗 -->
  <view class="profile-page__qr-modal" wx:if="{{showQRModal}}" bindtap="onCloseQRModal">
    <view class="profile-page__qr-content" catchtap="onQRContentTap">
      <!-- 弹窗头部（只有关闭按钮） -->
      <view class="profile-page__qr-header">
        <text class="profile-page__qr-title">助考二维码</text>
        <text class="iconfont icon-guanbi profile-page__qr-close" bindtap="onCloseQRModal"></text>
      </view>

      <!-- 二维码显示区域 -->
      <view class="profile-page__qr-container">
        <qr-code
          qr-data="{{userQRData}}"
          qr-type="user-profile"
          size="200"
          refreshable="{{true}}">
        </qr-code>
      </view>
    </view>
  </view>
</view>
