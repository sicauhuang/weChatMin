<!--pages/mock-tickets/mock-tickets.wxml-->
<view class="mock-tickets">
  <!-- 加载状态 -->
  <view class="mock-tickets__loading" wx:if="{{loading}}">
    <text class="mock-tickets__loading-text">加载中...</text>
  </view>

  <!-- 未登录状态 -->
  <view class="mock-tickets__login-prompt" wx:if="{{!isLoggedIn && !loading}}">
    <view class="mock-tickets__login-card">
      <text class="iconfont icon-piao mock-tickets__login-icon"></text>
      <text class="mock-tickets__login-text">登录后获取我的模拟票</text>
      <button class="mock-tickets__login-btn" bindtap="onGoLogin">
        现在登录
      </button>
    </view>
  </view>

  <!-- 模拟票列表 -->
  <scroll-view
    class="mock-tickets__scroll"
    scroll-y="{{true}}"
    refresher-enabled="{{true}}"
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    wx:elif="{{isLoggedIn}}"
  >
    <view class="mock-tickets__list">
      <view
        class="mock-tickets__card"
        wx:for="{{ticketList}}"
        wx:key="id"
      >
        <!-- 卡片头部 - 统一设计 -->
        <view class="mock-tickets__card-header">
          <view class="mock-tickets__title-group">
            <view class="mock-tickets__badge">
              <text class="iconfont icon-piao"></text>
            </view>
            <text class="mock-tickets__title">{{item.packageName}}</text>
          </view>
          <view class="mock-tickets__status mock-tickets__status--used" wx:if="{{item.status === '已核销'}}">
            {{item.status}}
          </view>
        </view>

        <!-- 票据信息区域 -->
        <view class="mock-tickets__info">
          <view class="mock-tickets__info-row">
            <text class="mock-tickets__label">学员姓名：</text>
            <text class="mock-tickets__value">{{item.studentName}}</text>
          </view>
          <view class="mock-tickets__info-row">
            <text class="mock-tickets__label">电话号码：</text>
            <text class="mock-tickets__value">{{item.studentPhone}}</text>
          </view>
          <view class="mock-tickets__info-row">
            <text class="mock-tickets__label">预约日期：</text>
            <text class="mock-tickets__value">{{item.appointmentDate}}</text>
          </view>
          <view class="mock-tickets__info-row">
            <text class="mock-tickets__label">模拟场区：</text>
            <text class="mock-tickets__value">{{item.simulationArea}}</text>
          </view>
          <view class="mock-tickets__info-row">
            <text class="mock-tickets__label">教练姓名：</text>
            <text class="mock-tickets__value">{{item.coachName}}</text>
          </view>
          <view class="mock-tickets__info-row">
            <text class="mock-tickets__label">教练电话：</text>
            <text class="mock-tickets__value">{{item.coachPhone}}</text>
          </view>
          <view class="mock-tickets__info-row" wx:if="{{item.verifyTime}}">
            <text class="mock-tickets__label">核销时间：</text>
            <text class="mock-tickets__value">{{item.verifyTime}}</text>
          </view>
        </view>

        <!-- 操作按钮区域 - 底部全宽 -->
        <view class="mock-tickets__actions" wx:if="{{item.status === '未使用'}}">
          <button class="mock-tickets__use-btn" bindtap="onUseTicket" data-item="{{item}}">
            去使用
          </button>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="mock-tickets__empty" wx:if="{{!ticketList.length && !loading}}">
      <text class="iconfont icon-piao mock-tickets__empty-icon"></text>
      <text class="mock-tickets__empty-text">暂无模拟票数据</text>
      <text class="mock-tickets__empty-desc">下拉刷新试试</text>
    </view>
  </scroll-view>

  <!-- 二维码弹窗 -->
  <view class="mock-tickets__qr-modal" wx:if="{{showQRModal}}" bindtap="onCloseQRModal">
    <view class="mock-tickets__qr-content" catchtap="onQRContentTap">
      <!-- 弹窗标题 -->
      <view class="mock-tickets__qr-header">
        <text class="mock-tickets__qr-title">模拟票二维码</text>
        <text class="iconfont icon-guanbi mock-tickets__qr-close" bindtap="onCloseQRModal"></text>
      </view>

      <!-- 票据信息 -->
      <view class="mock-tickets__qr-info" wx:if="{{currentTicketQRData}}">
        <view class="mock-tickets__qr-info-item">
          <text class="mock-tickets__qr-label">学员:</text>
          <text class="mock-tickets__qr-value">{{currentTicketQRData.studentName}}</text>
        </view>
        <view class="mock-tickets__qr-info-item">
          <text class="mock-tickets__qr-label">预约日期:</text>
          <text class="mock-tickets__qr-value">{{currentTicketQRData.appointmentDate}}</text>
        </view>
      </view>

      <!-- 二维码显示区域 -->
      <view class="mock-tickets__qr-container">
        <qr-code
          qr-data="{{currentTicketQRData}}"
          qr-type="mock-ticket"
          size="200"
          refreshable="{{true}}">
        </qr-code>
      </view>
    </view>
  </view>
</view>
