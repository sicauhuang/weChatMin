<!--pages/mock-tickets/mock-tickets.wxml-->
<view class="mock-tickets">
  <!-- 自定义导航栏 -->
  <view class="mock-tickets__header">
    <text class="mock-tickets__header-title">我的模拟票</text>
  </view>

  <!-- 加载状态 -->
  <view class="mock-tickets__loading" wx:if="{{loading}}">
    <text class="mock-tickets__loading-text">加载中...</text>
  </view>

  <!-- 模拟票列表 -->
  <scroll-view
    class="mock-tickets__scroll"
    scroll-y="{{true}}"
    refresher-enabled="{{true}}"
    refresher-triggered="{{refreshing}}"
    bindrefresherrefresh="onRefresh"
    wx:else
  >
    <view class="mock-tickets__list">
      <view
        class="mock-tickets__card"
        wx:for="{{ticketList}}"
        wx:key="id"
      >
        <!-- 顶部订单信息 -->
        <view class="mock-tickets__card-header">
          <view class="mock-tickets__order-info">
            <text class="iconfont icon-piao mock-tickets__ticket-icon"></text>
            <text class="mock-tickets__order-title">{{item.packageName}}</text>
          </view>
          <view class="mock-tickets__status mock-tickets__status--used" wx:if="{{item.status === '已核销'}}">
            {{item.status}}
          </view>
        </view>

        <!-- 学员信息 -->
        <view class="mock-tickets__student">
          <view class="mock-tickets__info-item">
            <text class="mock-tickets__icon"></text>
            <text class="mock-tickets__label">学员:</text>
            <text class="mock-tickets__student-name">{{item.studentName}}</text>
          </view>
          <view class="mock-tickets__info-item">
            <text class="mock-tickets__icon"></text>
            <text class="mock-tickets__label">电话:</text>
            <text class="mock-tickets__student-phone">{{item.studentPhone}}</text>
          </view>
        </view>

        <!-- 预约信息 -->
        <view class="mock-tickets__appointment">
          <view class="mock-tickets__info-item">
            <text class="mock-tickets__icon"></text>
            <text class="mock-tickets__label">预约日期:</text>
            <text class="mock-tickets__text">{{item.appointmentDate}}</text>
          </view>
          <view class="mock-tickets__info-item">
            <text class="mock-tickets__icon"></text>
            <text class="mock-tickets__label">模拟厂区:</text>
            <text class="mock-tickets__text">{{item.simulationArea}}</text>
          </view>
        </view>

        <!-- 教练信息 -->
        <view class="mock-tickets__coach">
          <view class="mock-tickets__info-item">
            <text class="mock-tickets__icon"></text>
            <text class="mock-tickets__label">教练:</text>
            <text class="mock-tickets__coach-name">{{item.coachName}}</text>
            <text class="mock-tickets__separator">·</text>
            <text class="mock-tickets__coach-phone">{{item.coachPhone}}</text>
          </view>

          <view class="mock-tickets__info-item" wx:if="{{item.verifyTime}}">
            <text class="mock-tickets__icon"></text>
            <text class="mock-tickets__label">核销时间:</text>
            <text class="mock-tickets__text">{{item.verifyTime}}</text>
          </view>
        </view>

        <!-- 操作按钮区域 - 底部全宽 -->
        <view class="mock-tickets__actions" wx:if="{{item.status === '未使用'}}">
          <button class="mock-tickets__use-btn" bindtap="onUseTicket" data-item="{{item}}">
            去使用
          </button>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="mock-tickets__empty" wx:if="{{!ticketList.length && !loading}}">
      <text class="iconfont icon-piao mock-tickets__empty-icon"></text>
      <text class="mock-tickets__empty-text">暂无模拟票数据</text>
      <text class="mock-tickets__empty-desc">下拉刷新试试</text>
    </view>
  </scroll-view>

  <!-- 二维码弹窗 -->
  <view class="mock-tickets__qr-modal" wx:if="{{showQRModal}}" bindtap="onCloseQRModal">
    <view class="mock-tickets__qr-content" catchtap="onQRContentTap">
      <!-- 弹窗标题 -->
      <view class="mock-tickets__qr-header">
        <text class="mock-tickets__qr-title">模拟票二维码</text>
        <text class="iconfont icon-guanbi mock-tickets__qr-close" bindtap="onCloseQRModal"></text>
      </view>

      <!-- 票据信息 -->
      <view class="mock-tickets__qr-info" wx:if="{{currentTicket}}">
        <view class="mock-tickets__qr-info-item">
          <text class="mock-tickets__qr-label">订单号:</text>
          <text class="mock-tickets__qr-value">{{currentTicket.orderNumber}}</text>
        </view>
        <view class="mock-tickets__qr-info-item">
          <text class="mock-tickets__qr-label">学员:</text>
          <text class="mock-tickets__qr-value">{{currentTicket.studentName}}</text>
        </view>
        <view class="mock-tickets__qr-info-item">
          <text class="mock-tickets__qr-label">预约时间:</text>
          <text class="mock-tickets__qr-value">{{currentTicket.appointmentDate}}</text>
        </view>
      </view>

      <!-- 二维码显示区域 -->
      <view class="mock-tickets__qr-container">
        <image
          class="mock-tickets__qr-image"
          src="{{qrCodeUrl}}"
          mode="aspectFit"
          wx:if="{{!qrLoading && qrCodeUrl}}"
        ></image>
        <view class="mock-tickets__qr-loading" wx:if="{{qrLoading}}">
          <text class="mock-tickets__qr-loading-text">生成中...</text>
        </view>
      </view>

      <!-- 操作按钮 -->
      <view class="mock-tickets__qr-actions">
        <button class="mock-tickets__qr-btn mock-tickets__qr-btn--save" bindtap="onSaveQRCode">
          保存到相册
        </button>
        <button class="mock-tickets__qr-btn mock-tickets__qr-btn--close" bindtap="onCloseQRModal">
          关闭
        </button>
      </view>
    </view>
  </view>
</view>
