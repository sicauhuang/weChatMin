### 微信小程序开发

当前是微信小程序项目，主要实现一个带有车源，模拟票的小程序功能。车源用于提供用户查看车辆信息，便于用户买车；模拟票功能用于提供用户购买驾校模拟考试的模拟考试票。

#### 整体架构设计

##### 小程序风格说明

- 小程序整体的UI展示风格需要统一，需要一种浅色主题，整体风格不要太突兀，以便用户接受。

##### 小程序tabBar内容说明

- 小程序整体在tabbar页面中，包含4个页面，有首页，车源，模拟票，我的。
其中显示样式按现有存在实现，要有tab的名称与其icon。现在已经存在首页，我的两个tab，需要增加车源和模拟票两个tab。

- 首页：主要展示用于展示公司信息，产品介绍，联系方式等。
- 车源：主要展示车源信息，包括车型，车牌号，车主，联系方式等。
- 模拟票：主要展示驾校模拟考试的模拟考试票，包括考试时间，考试地点，考试科目，考试内容，考试费用等。
- 我的：主要展示用户个人信息与常用的一些功能等。

##### 页面设计说明

小程序大部分需要icon结合文字展示内容，其中icon的显示是使用本地的icon字体，使用的来源是阿里巴巴矢量图标库（iconfont）。存放icon的样式文件统一放置与：/Users/xiaofeng/WeChatProjects/miniprogram-1/assets/fonts/iconfont.wxss。

后续需要使用icon的位置，需要统一使用iconfont样式显示图标，其中我会给出指定图标的css以完成图标的显示。

##### 开发需求说明

1、目前开发过程中，后端接口不一定先设计完成，单前端需要按需求显示页面内容。后端接口可以先根据/Users/xiaofeng/WeChatProjects/miniprogram-1/server定义的服务器添加临时接口，后续进行真实接口对接即可
2、小程序样式实现时，类名命名需要遵守BEM规范，方便后续维护。

##### 图标与文字样式等主题建设

需要一个统一的主题文件，内部定义文字颜色，大小，自重，图标颜色等统一的主题样式变量，后续所有的相关UI都可以直接引用该文件的样式主题变量进行样式设置。
文件需求：
1、主题变量命名需要有语义化，不能随意命名；
2、主题在app.wxss中引用，统一设置全局样式；
3、 主题样式文件位置：/Users/xiaofeng/WeChatProjects/miniprogram-1/assets/styles/theme.wxss

#### tabBar页面需求

- 首页：首页暂未确定展示内容，先暂时不动，后续再补充。
- 车源：主要展示车源信息，包括车型，车牌号，车主，联系方式等。暂设计一个占位page
- 模拟票：主要展示驾校模拟考试的模拟考试票，包括考试时间，考试地点，考试科目，考试内容，考试费用等。暂设计一个占位page
- 我的：主要展示用户个人信息与常用的一些功能等。后续续期在设计，保持现状态。

相应的tabBar名称与其的对应的icon。
首页：icon-shouye
车源：icon-cheyuan
模拟票：icon-piao
我的：icon-wode

##### 需求要点

- 该需要主要展示tabBar的基础建设，不要求对应页面内容的实现，后续再根据需求进行页面的设计与实现。
- 完成tabBar的基础UI建设后，要确保在切换tab时，高亮效果能够正常显示。

#### 首页需求

1. 首页展示公司宣传图片，公司简介，地址，联系方式。
2、首页需要使用走马灯效果，因为图片存在多张。
3、UI设计自定义发挥，但是需要考虑手机使用微信小程序显示的效果，不能太花哨。需要保持小程序整体风格

##### 页面逻辑设计

- 首页显示的内容需要通过接口获取，目前后端暂未定义接口内容，先使用server定义接口，后续进行真实接口对接。
- mock接口需要先定义好，该接口包含的信息参考：

```
{
    imgList: [url, url],
    companyName: 'xxx公司',
    companyDesc: 'xxx公司简介',
    companyAddress: 'xxx公司地址',
    companyContact: 'xxx公司联系方式',}
```

##### 页面UI-icon

公司：icon-gongsi
联系我们：icon-lianxi
电话：icon-dianhua
地址：icon-dizhi

#### 首页与整体UI调整

小程序显示时，顶部显示了首页文字与白色背景，需要直接不显示该文字与背景

#### 我的tab页面需求

##### 页面需求1

从上到下显示内容为用户登录信息，与login页面类似。
UI上需要一个头像，昵称，身份信息。背景色需要设置为主题色，显示的范围为顶部到半屏的主题色到默认灰白的渐变色。

登录区域设计为一个卡片式：示意
---------------------------------------|

                                       |
   ————|      昵称                      |
   | 头像 |   身份                      |
   ————|                               |
                                       |
                                       |
---------------------------------------|

逻辑设计：我的tab页中，按登录与未登录状态显示不同内容.

未登录状态：头像，昵称使用getUserProfile获取的默认头像与昵称进行显示，身份信息显示为“游客”。
暂不考虑登录流程的功能，只考虑UI的设计显示，后续进行登录流程的设计与实现。

##### 页面需求2

在我的页面中，登录信息的卡片下边框上，添加一个悬浮显示区域显示：我的足迹，我的收藏两个跳转文本。
点击对应按钮跳转后进入对应页面，需要新建个占位的页面

##### 页面需求3

在我的页面中，登录信息的卡片下方，显示当前拥有的功能模块，单个功能模块排版大致：
-------------------------------|

                               |

  icon  功能模块名称           > |
-------------------------------|

功能模块大致有：

- 我的二维码
- 我要买车
- 审批车辆
- 模拟票核销
- 模拟票助考
- 设置

目前只显示UI，对应的按钮功能不考虑实现，后续再根据需求进行实现。
icon:
我的二维码:icon-erweima
我要买车:icon-maiche
审批车辆:shenpi
模拟票核销:icon-saoma
模拟票助考:icon-zhukao
设置:icon-shezhi

##### 页面需求4

该需求主要对我的tab页面进行UI调整：

1、设置功能模块不单独在功能模块中显示，将功能模块的图标移动到用户信息卡片的右上角悬浮。
2、显示的我的足迹与我的收藏不在显示在用户信息的下边缘上，显示UI示意：

-----------------------------|
                             |
用户信息                      |
                             |
-----------------------------|

-------------  ---------------
   我的足迹  |  |    我的收藏    |
            |  |              |
—————————————   ———————————————

#### 页面需求5

在我的tab页面中，整体内容没有超过一屏，但是有滚动条，可以往下滚动，这是异常吗，不期望内容未超过一屏，还能进行滚动

#### 登录功能设计

登录功能按状态分为未登录与登录完成两种情况：

- 未登录：
未登录时，在我的tab页中，显示的用户信息卡片中，头像，用户名称，身份信息按现有的显示:
头像：默认值：/Users/xiaofeng/WeChatProjects/miniprogram-1/assets/imgs/touxiang.png
昵称：微信用户
身份：默认显示“未登录”

点击用户信息部分，包括头像，昵称，身份部分时，跳转到登录页面，在登录页面中进行手机号快捷登录：
UI设计：
从上往下排版：
1、logo：logo位置：/Users/xiaofeng/WeChatProjects/miniprogram-1/assets/imgs/logo.png；现在在竖屏上三分之一位置
2、公司名称：车小禾，公司名称显示在logo下方，居中显示
3、快捷登录按钮：

- 显示文本：“手机号快捷登录”，按钮显示在竖屏二分之一下方位置，在按钮上方保留一点距离显示用户协议与隐私政策的勾选。

________________________________
                                |
                                |
                                |
                                |
            logo                |
            车小禾               |
                                |
                                |
                                |
      用户协议，隐私政策           |
                                |

———————————————————————————   |
   |          登录            |  |
   ---------------------------   |
                                |
                                |
                                |
                                |
---------------------------------

##### 登录UI交互设计

1、按钮本身不设置禁用。
2、在勾选用户协议情况下，按钮能直接进行登录。
3、在未勾选用户协议情况下，登录按钮点击后，给出弹窗，提示用户:我已阅读并同意《用户协议》和《隐私政策》。给出按钮：不同意，同意。

##### 登录逻辑设计

1、进入登录页面时后，如果用户勾选了用户协议或弹窗中同意按钮确定后，进行登录流程：

- 同意按钮与手机号快捷登录两个按钮中，当点击后进行手机号授权流程，当用户授权后，得到编码的手机号数据与iv。
- 调用wx.login获取code，然后调用后端登录接口，将编码的手机号数据与iv与code发送给后端，后端对手机号数据进行解密，将后端解密完成后，将返回accessToken与refreshToken与手机号。
- 将accessToken与refreshToken，手机号保存到本地，设置登录成功状态，然后退回到profile页面中。
2、如果用户未勾选用户协议或弹窗中不同意按钮，则不进行登录流程。
3、如果用户在登录页面中点击返回按钮，则退回到上一页面。
4、需要考虑将wx.request进行封装，还需要封装一个设置headers的方法，该方法需要将accessToken设置到headers中，以便后续接口调用时，自动带上accessToken。后续接口使用新封装的请求方法。

后端接口使用模拟的server，接口定义上按接口进行mock设计，后续进行真实接口对接。

##### 登录流程补充说明

1、登录成功以后，自动返回profile页面，profile页面检测当前的登录状态，如果完成了登录流程，显示的用户信息：

- 头像：assets/imgs/logo.png
- 昵称：登录后的手机号
- 身份：更改为“游客”

2、在profile页面中，登录成功后再次当点击用户信息部分，使用showActionSheet展示内容按钮，包含：

- 注销账号：显示按钮即可，不考虑功能实现。
- 退出登录：显示按钮，点击后给出弹窗提示：请确认是佛偶退出此次登录，确定后清除本地缓存数据，将用户信息显示的内容重置为未登录的显示文本与头像等。

##### token刷新说明

在上次用户登录完成后关闭了小程序但为退出，这时进入小程序后，app.js检测用户在登录状态，有refreshToken时，需要调用刷新token的后端接口，参数为refreshToken，后端响应成功，会将最新的accessToken与refreshToken返回，这时需要将token重新进行保存，将accessToken设置到headers中，以便后续接口调用时，自动带上accessToken。

#### 模拟票tab页面需求

该页面主要展示驾校模拟考试的模拟考试票，包括考试时间，考试地点，考试科目，考试内容，考试费用等。

导航栏：文本：“模拟票列表”
UI设计：
模拟票列表每个模拟票需要显示为卡片风格，模拟票数据需要通过后端接口进行获取，获取的单个模拟票数据包含：

- 套餐名称
- 学员姓名
- 学员电话
- 预约日期
- 状态（未使用、已核销）
- 驾校名称
- 教练姓名
- 教练电话
- 模拟场区
- 操作人
- 操作时间
- 助考员姓名
- 核销时间

模拟票列表的UI设计：

- 卡片式：
需要显示学员重点关注的信息：
- 套餐名称
- 学员姓名
- 学员电话
- 预约日期
- 状态（未使用、已核销）
- 教练姓名
- 教练电话
- 模拟场区
- 核销时间
信息展示的内容按整体风格进行设计使用。


##### 模拟票功能逻辑
在模拟票中，如果票是未核销状态会显示去使用按钮，按钮逻辑：

- 点击按钮，将当前票的id,学员手机号组成可用信息让然后生成二维码。