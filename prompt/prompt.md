### 微信小程序开发

当前是微信小程序项目，主要实现一个带有车源，模拟票的小程序功能。车源用于提供用户查看车辆信息，便于用户买车；模拟票功能用于提供用户购买驾校模拟考试的模拟考试票。

#### 整体架构设计

##### 小程序风格说明

- 小程序整体的UI展示风格需要统一，需要一种浅色主题，整体风格不要太突兀，以便用户接受。小程序使用的UI组件库位Vant Weapp，该组件库提供了丰富的UI组件，可以快速实现小程序的UI效果。

##### 小程序tabBar内容说明

- 小程序整体在tabbar页面中，包含4个页面，有首页，车源，模拟票，我的。
其中显示样式按现有存在实现，要有tab的名称与其icon。现在已经存在首页，我的两个tab，需要增加车源和模拟票两个tab。

- 首页：主要展示用于展示公司信息，产品介绍，联系方式等。
- 车源：主要展示车源信息，包括车型，车牌号，车主，联系方式等。
- 模拟票：主要展示驾校模拟考试的模拟考试票，包括考试时间，考试地点，考试科目，考试内容，考试费用等。
- 我的：主要展示用户个人信息与常用的一些功能等。

##### 页面设计说明

小程序大部分需要icon结合文字展示内容，其中icon的显示是使用本地的icon字体，使用的来源是阿里巴巴矢量图标库（iconfont）。存放icon的样式文件统一放置与：/Users/xiaofeng/WeChatProjects/miniprogram-1/assets/fonts/iconfont.wxss。

后续需要使用icon的位置，需要统一使用iconfont样式显示图标，其中我会给出指定图标的css以完成图标的显示。

##### 开发需求说明

1、目前开发过程中，后端接口不一定先设计完成，单前端需要按需求显示页面内容。后端接口可以先根据/Users/xiaofeng/WeChatProjects/miniprogram-1/server定义的服务器添加临时接口，后续进行真实接口对接即可
2、小程序样式实现时，类名命名需要遵守BEM规范，方便后续维护。

##### 图标与文字样式等主题建设

需要一个统一的主题文件，内部定义文字颜色，大小，自重，图标颜色等统一的主题样式变量，后续所有的相关UI都可以直接引用该文件的样式主题变量进行样式设置。
文件需求：
1、主题变量命名需要有语义化，不能随意命名；
2、主题在app.wxss中引用，统一设置全局样式；
3、 主题样式文件位置：/Users/xiaofeng/WeChatProjects/miniprogram-1/assets/styles/theme.wxss

#### tabBar页面需求

- 首页：首页暂未确定展示内容，先暂时不动，后续再补充。
- 车源：主要展示车源信息，包括车型，车牌号，车主，联系方式等。暂设计一个占位page
- 模拟票：主要展示驾校模拟考试的模拟考试票，包括考试时间，考试地点，考试科目，考试内容，考试费用等。暂设计一个占位page
- 我的：主要展示用户个人信息与常用的一些功能等。后续续期在设计，保持现状态。

相应的tabBar名称与其的对应的icon。
首页：icon-shouye
车源：icon-cheyuan
模拟票：icon-piao
我的：icon-wode

##### 需求要点

- 该需要主要展示tabBar的基础建设，不要求对应页面内容的实现，后续再根据需求进行页面的设计与实现。
- 完成tabBar的基础UI建设后，要确保在切换tab时，高亮效果能够正常显示。

#### 首页需求

1. 首页展示公司宣传图片，公司简介，地址，联系方式。
2、首页需要使用走马灯效果，因为图片存在多张。
3、UI设计自定义发挥，但是需要考虑手机使用微信小程序显示的效果，不能太花哨。需要保持小程序整体风格

##### 页面逻辑设计

- 首页显示的内容需要通过接口获取，目前后端暂未定义接口内容，先使用server定义接口，后续进行真实接口对接。
- mock接口需要先定义好，该接口包含的信息参考：

```
{
    imgList: [url, url],
    companyName: 'xxx公司',
    companyDesc: 'xxx公司简介',
    companyAddress: 'xxx公司地址',
    companyContact: 'xxx公司联系方式',}
```

##### 页面UI-icon

公司：icon-gongsi
联系我们：icon-lianxi
电话：icon-dianhua
地址：icon-dizhi

#### 首页与整体UI调整

小程序显示时，顶部显示了首页文字与白色背景，需要直接不显示该文字与背景

#### 我的tab页面需求

##### 页面需求1

从上到下显示内容为用户登录信息，与login页面类似。
UI上需要一个头像，昵称，身份信息。背景色需要设置为主题色，显示的范围为顶部到半屏的主题色到默认灰白的渐变色。

登录区域设计为一个卡片式：示意
---------------------------------------|

                                       |
   ————|      昵称                      |
   | 头像 |   身份                      |
   ————|                               |
                                       |
                                       |
---------------------------------------|

逻辑设计：我的tab页中，按登录与未登录状态显示不同内容.

未登录状态：头像，昵称使用getUserProfile获取的默认头像与昵称进行显示，身份信息显示为“游客”。
暂不考虑登录流程的功能，只考虑UI的设计显示，后续进行登录流程的设计与实现。

##### 页面需求2

在我的页面中，登录信息的卡片下边框上，添加一个悬浮显示区域显示：我的足迹，我的收藏两个跳转文本。
点击对应按钮跳转后进入对应页面，需要新建个占位的页面

##### 页面需求3

在我的页面中，登录信息的卡片下方，显示当前拥有的功能模块，单个功能模块排版大致：
-------------------------------|

                               |

  icon  功能模块名称           > |
-------------------------------|

功能模块大致有：

- 我的二维码
- 我要买车
- 审批车辆
- 模拟票核销
- 模拟票助考
- 设置

目前只显示UI，对应的按钮功能不考虑实现，后续再根据需求进行实现。
icon:
我的二维码:icon-erweima
我要买车:icon-maiche
审批车辆:shenpi
模拟票核销:icon-saoma
模拟票助考:icon-zhukao
设置:icon-shezhi

##### 页面需求4

该需求主要对我的tab页面进行UI调整：

1、设置功能模块不单独在功能模块中显示，将功能模块的图标移动到用户信息卡片的右上角悬浮。
2、显示的我的足迹与我的收藏不在显示在用户信息的下边缘上，显示UI示意：

-----------------------------|
                             |
用户信息                      |
                             |
-----------------------------|

-------------  ---------------
   我的足迹  |  |    我的收藏    |
            |  |              |
—————————————   ———————————————

#### 页面需求5

在我的tab页面中，整体内容没有超过一屏，但是有滚动条，可以往下滚动，这是异常吗，不期望内容未超过一屏，还能进行滚动

#### 登录功能设计

登录功能按状态分为未登录与登录完成两种情况：

- 未登录：
未登录时，在我的tab页中，显示的用户信息卡片中，头像，用户名称，身份信息按现有的显示:
头像：默认值：/Users/xiaofeng/WeChatProjects/miniprogram-1/assets/imgs/touxiang.png
昵称：微信用户
身份：默认显示“未登录”

点击用户信息部分，包括头像，昵称，身份部分时，跳转到登录页面，在登录页面中进行手机号快捷登录：
UI设计：
从上往下排版：
1、logo：logo位置：/Users/xiaofeng/WeChatProjects/miniprogram-1/assets/imgs/logo.png；现在在竖屏上三分之一位置
2、公司名称：车小禾，公司名称显示在logo下方，居中显示
3、快捷登录按钮：

- 显示文本：“手机号快捷登录”，按钮显示在竖屏二分之一下方位置，在按钮上方保留一点距离显示用户协议与隐私政策的勾选。

________________________________
                                |
                                |
                                |
                                |
            logo                |
            车小禾               |
                                |
                                |
                                |
      用户协议，隐私政策           |
                                |

———————————————————————————   |
   |          登录            |  |
   ---------------------------   |
                                |
                                |
                                |
                                |
---------------------------------

##### 登录UI交互设计

1、按钮本身不设置禁用。
2、在勾选用户协议情况下，按钮能直接进行登录。
3、在未勾选用户协议情况下，登录按钮点击后，给出弹窗，提示用户:我已阅读并同意《用户协议》和《隐私政策》。给出按钮：不同意，同意。

##### 登录逻辑设计

1、进入登录页面时后，如果用户勾选了用户协议或弹窗中同意按钮确定后，进行登录流程：

- 同意按钮与手机号快捷登录两个按钮中，当点击后进行手机号授权流程，当用户授权后，得到编码的手机号数据与iv。
- 调用wx.login获取code，然后调用后端登录接口，将编码的手机号数据与iv与code发送给后端，后端对手机号数据进行解密，将后端解密完成后，将返回accessToken与refreshToken与手机号。
- 将accessToken与refreshToken，手机号保存到本地，设置登录成功状态，然后退回到profile页面中。
2、如果用户未勾选用户协议或弹窗中不同意按钮，则不进行登录流程。
3、如果用户在登录页面中点击返回按钮，则退回到上一页面。
4、需要考虑将wx.request进行封装，还需要封装一个设置headers的方法，该方法需要将accessToken设置到headers中，以便后续接口调用时，自动带上accessToken。后续接口使用新封装的请求方法。

后端接口使用模拟的server，接口定义上按接口进行mock设计，后续进行真实接口对接。

##### 登录流程补充说明

1、登录成功以后，自动返回profile页面，profile页面检测当前的登录状态，如果完成了登录流程，显示的用户信息：

- 头像：assets/imgs/logo.png
- 昵称：登录后的手机号
- 身份：更改为“游客”

2、在profile页面中，登录成功后再次当点击用户信息部分，使用showActionSheet展示内容按钮，包含：

- 注销账号：显示按钮即可，不考虑功能实现。
- 退出登录：显示按钮，点击后给出弹窗提示：请确认是佛偶退出此次登录，确定后清除本地缓存数据，将用户信息显示的内容重置为未登录的显示文本与头像等。

##### token刷新说明

在上次用户登录完成后关闭了小程序但为退出，这时进入小程序后，app.js检测用户在登录状态，有refreshToken时，需要调用刷新token的后端接口，参数为refreshToken，后端响应成功，会将最新的accessToken与refreshToken返回，这时需要将token重新进行保存，将accessToken设置到headers中，以便后续接口调用时，自动带上accessToken。

#### 模拟票tab页面需求

该页面主要展示驾校模拟考试的模拟考试票，包括考试时间，考试地点，考试科目，考试内容，考试费用等。

导航栏：文本：“模拟票列表”
UI设计：
模拟票列表每个模拟票需要显示为卡片风格，模拟票数据需要通过后端接口进行获取，获取的单个模拟票数据包含：

- 套餐名称
- 学员姓名
- 学员电话
- 预约日期
- 状态（未使用、已核销）
- 驾校名称
- 教练姓名
- 教练电话
- 模拟场区
- 操作人
- 操作时间
- 助考员姓名
- 核销时间
- 证件号码

模拟票列表的UI设计：

- 卡片式：
需要显示学员重点关注的信息：
- 套餐名称
- 学员姓名
- 学员电话
- 预约日期
- 状态（未使用、已核销）
- 教练姓名
- 教练电话
- 模拟场区
- 核销时间
信息展示的内容按整体风格进行设计使用。

##### 模拟票二维码功能逻辑

在模拟票中，如果票是未核销状态会显示去使用按钮，按钮逻辑：

- 点击按钮，将当前票的id,学员手机号组成可用信息让然后生成二维码。

##### 模拟票二维码功能优化

1、需要存储到二维码中的信息，需要做先设置编码，将编码后的数据在存储二维码进行显示
2、存储的二维码信息需要加入有效期时间，超过有效期时间，二维码失效。有效期规则：点击去使用二维码的时间为起始时间，有效期往后推3分钟。
3、在显示二维码的弹窗中，当创建完二维码后，当用户点击二维码后需要能刷新当前二维码，重置过期时间为刷新时间。

##### 模拟票功能调整

1、模拟票页面需要检测当前用户是否登录，如果登录完成，则按当前获取模拟票的流程进行。
2、如果用户未登录，需要用户登录后才能继续后续流程，提示内容：

- 提示语：登录后获取我的模拟票
- 按钮：现在登录：跳转到快捷登录页面

#### 模拟票助考功能

在profile页面中，模拟票助考按钮点击后跳转到模拟票助考页面，页面显示当前用户的模拟票列表，每个模拟票显示的模拟票样式和模拟票页面的模拟票列表样式相同，但只显示部分字段的内容：
包括：

- 套餐名称
- 学员姓名
- 核销人
- 核销时间

数据获取需要使用接口进行获取，接口的后端字段需要和之前定义的字段保持一致：现在server的位置：/Users/xiaofeng/WeChatProjects/server/app.js

#### 我的tab页-我的二维码功能

我的二维码按钮功能，在点击后，将当前用户的姓名，电话信息，经过转码后生成二维码，二维码显示使用弹窗，弹窗只给一个关闭按钮，不需要title。
二维码数据使用的数据来源使用存储在storage的用户信息即可。二维码不能保存相册，弹窗只有展示与关闭功能。二维码的实现在模拟票的tab页实现过，需要保留加载时的文本提示，加载完成后点击二维码进行刷新的功能

##### 二维码公共组件建设

- 当前完成了我的tab页-我的二维码功能章节的需求设计与代码开发，并根据mock-tickets的功能的我的二维码功能抽离了一个一个公共组件：/Users/xiaofeng/WeChatProjects/miniprogram-1/components/qr-code-modal。
- 抽离的原因：现在mock-tickets页面与profi页面都进行了使用，且二维码功能是将指定的数据编码进行二维码展示，二维码展示有时效性信息，创建与刷新都带有提示。因此抽离为一个公共组件，该组件接受一个需要二维码展示的数据，需要的type融入该数据就行，剩下的二维码展示都是通用功能

- 期望效果：现在组件目前不是期望的效果，需要进行调整。该组件是希望只实现使用canvas画布绘制二维码的功能，外部不接管二维码如何实现。如果需要放入弹窗中，则在弹窗中显示二维码，即只关注根据传入的数据编码展示成二维码

- 改造：在完成二维码组件后，在不改变原有的展示方式的情况下，替换mock-tickets页面与我的二维码功能的使用。

- 我的tab页-我的二维码功能实现不达预期效果：点击后给个弹窗，弹窗只显示二维码，该二维码的数据是用户信息，而不是现在的用户信息与模拟票的切换，只有用户信息。

##### 二维码功能组件优化

1、期望二维码展示为正方形，且适当大小，显示位置居中

#### 登录功能调整

登录流程的用户信息获取现设计为：
1、如果未登录，需要在用户登录完成后，使用单独的接口获取getUserProfile获取用户信息，获取的用户信息包含：

- 手机号
- 姓名
- 按钮权限（设计为array即可， mock数据可以为空，暂不考虑权限问题）
在登录接口中只会返回accessToken与refreshToken，不返回用户信息。
2、如果已登录，用户在未登出小程序情况下，下次进入小程序后，小程序加载时，需要通过接口获取最新的用户信息，获取成功需要重新存储到本地。

##### 用户信息获取当前设计的页面与文件

- profile页面
- login页面
- /Users/xiaofeng/WeChatProjects/miniprogram-1/app.js
- /Users/xiaofeng/WeChatProjects/miniprogram-1/utils/auth.js
- /Users/xiaofeng/WeChatProjects/miniprogram-1/utils/storage.js

要求：
1、用户信息的获取与刷新需要进行模块化处理，外部使用是需要调用该函数模块既可以，现在在auth.storage.js中存在重复性联络。需要梳理下涉及的页面与模块的逻辑，重新输出可行性方案
2、服务器的接口定义：/Users/xiaofeng/WeChatProjects/server/app.js，需要按新的需求完成登录接口的定义与用户信息的接口的定义与mock数据。注意：目前用户信息获取后只会存储到本地，暂时没有使用的地方，后续会有需求去使用，所以不要考虑额外如何使用这些用户数据场景
3、如果需要设计新街口，只保留最新设计接口，不需要设计旧接口兼容，程序运行逻辑一切按最新接口定义的去实现，不考虑兼容

#### 模拟票核销功能

在profile页面中，当点击模拟票核销按钮后，跳转到核销页面中：
页面显示内容主要包含两部分：
1、滚动列表：显示核销的模拟票。
2、在底部显示中间显示核销按钮，核销按钮只显示一个图标，不显示文本。底部的样式需要与底部按钮风格需要保持一体，不能只设计按钮样式。

其他功能逻辑一概不需要考虑，当前值实现UI设计即可。

##### 核销按钮UI调整

1、底部按钮显示了扫码核销按钮，此外还需要再同一行显示确认核销的按钮，按钮功能需要实现

##### 核销逻辑

1、点击底部核销按钮后，调起扫码功能，将扫描后的二维码数据使用解码函数解析解码，解密完成后打印出来即可
2、补充获取用户信息接口mock数据，接口返回时在现在基础上会返回用户id（userId）。
3、扫码功能：扫码只会扫描当前的模拟票的二维码，或者助考员的二维码。扫码完成解码后票数据中会有type字段，票按type分类，其中学员模拟票的type为mock-ticket，助考员为assist-ticket。
扫描后数据需要在票列表中显示，现在的列表的UI可以直接使用，按票的type显示不同数据：

- 学员模拟票：显示套餐名称，学员姓名，证件号码，模拟场区。按现在UI的设计，title显示的是套餐名称
- 助考员模拟票：显示助考员姓名，电话。title显示固定文本：”助考员信息“。其中助考员的票为了更为突出，将背景颜色设置为主题色
4、扫码数据采用的规则：扫码后，数据解析后不是所有的票都要是使用，需要有这些规则：
- 学生模拟票同一位学员的票多次扫码，只保留一张，多次扫码场景下需要替换掉上次扫码的数据。因此需要根据现有的数据结构确认可以作为唯一id的字段，可以采用手机号。
- 获取到票数据后，最先确认票的有效期，如果当前未到有效期则允许使用该票数据。

确认校验的按钮校验：

- 必须要有一位且只能有一位助考员，学员票至少1张，最多4张；
点击确认后，先给个弹窗，提示当前需要进行核销的学员姓名，助考员姓名，确定后，将数据提交到后端。

接口定义：

- /api/ticket/verify
- post
- 请求参数：
{
    assistantUserId: string, // 助考员id
    ticketIdList: string[], // 票id列表
}

##### 核销优化

需求内容：在核销页面中，显示的票数据来源于扫码后的结果进行展示，没有是否已核销的状态区分，显示的票已不需要title来显示是助考员还是学员，都在一个滚动列表中显示，在用户点击确认核销后，需要清除存储在本地的扫码数据，以供下次重新核销
要点：
1、扫描后的数据使用变量在当前页面赋值保存就行，不需要本地保存，
2、票据标识不做额外的样式，保持需求提到的助考员显示的卡片样式是与学员不同的就行，按现有的方案就行。
3、在确定核销弹窗中确认后，后端接口返回成功，即可清除保存在变量中的核销票据信息
4、扫码的顺序不一定一致，因此期望助考员的票据显示始终在最后一个显示

#### 模拟票卡片样式优化

阅读ticket-verification页面中关于列表显示票UI的代码，确认学员票卡片显示的UI与样式，将该样式与UI展示直接应用到mock-tickets页面的模拟票列表的票卡片，assist-exam页面的助考列表卡片中

#### 核销票样式优化

在ticket-verification页面中对UI进行优化：
1、票卡片title左侧的icon不设置背景色，右侧的删除图标，设置显示的颜色为error色，不设置背景
2、助考员卡片进行简化，和现在的风格保持一致，但是调整背景色与和学员票卡片一样，文字颜色使用主题色

#### 我要卖车

##### 卖车页面UI设计

需求内容：
1、在profile页面中，点击我要卖车按钮，跳转到卖车页面：
在卖车页面中：从上往下需要显示两部分，一个是新建车辆的按钮，下方是滚动列表，显示用户的车辆信息卡片。
再该点需求中，只完成了卖车页面的UI设计，不去完成数据功能实现。

2、车辆列表UI实现：现在车辆列表UI已完成，需要实现发布页的车辆列表中的车辆卡片，以帮助用户查看自己发布的车辆信息。
车辆卡片包含的信息内容包括：

- 预览图
- 品牌
- 车系
- 款式
- 上牌时间
- 里程
- 颜色
- 过户次数
- 零售价

显示的示意UI
------------------------------------------------------------

                | 品牌 车系  款式 （三个参数整体一行显示，超出可换行）
                |
    预览图       | 上牌时间 里程  颜色  过户次数
                |
                | 零售价                            (收藏按钮)
————————————————--------------------------------------------

要点实现：需要使用主题变量样式进行开发

3、车辆卡片UI进行一步优化：
3.1、在当前车辆卡片右侧打的零售价右侧显示收藏按钮，默认未收藏使用icon:icon-shoucang，点击收藏后使用.icon-yishoucang。收藏只需要实现UI效果即可。
3.2、在底部新增删除按钮，点击删除按钮后，在点击该按钮后，进入删除模式，车辆卡片左侧显示圆形的单选框，点击车辆不能进入详情，只会勾选当前单选框，点击确认删除后，将该车辆信息从服务器中删除。

##### 车辆卡片组件抽离

1、现在的卖车页面中，渲染的车辆卡片已完成，现在后续需要将该车辆卡片抽离为一个公共组件，方便其他页面使用。
2、该卡片的包含的内容：
2.1 UI设计上保持不变，该组件只是一个纯UI组件，不包含任何业务逻辑，只负责UI显示。
2.2 该组件接受一个车辆信息对象，卡片组件使用传入的车辆信息对象进行数据UI的渲染
2.3 在卖车页面的卡片中，存在收藏与删除功能，详情跳转：
2.3.1 收藏功能：其中收藏功能中，在点击后给出一个事件回调，回调需要标明当前是收藏还是取消收藏与当前车辆信息，已帮助外部处理收藏功能。
2.3.2 删除功能：外部设置当前是否是删除模式，删除模式下，显示卡片勾选按钮，在勾选或取消时，给出一个事件回调，回调勾选状态与当前车辆信息，已帮助外部处理删除功能。
2.3.3 详情跳转：点击卡片时，直接触发回调事件，告知接入页面当前需要查看详情的车辆信息即可。

#### 审批车辆功能实现

当前是需要实现审批车辆列表页，入口是profile页面中，点击审批车辆按钮，跳转到审批车辆列表页。
页面总体UI可参考卖车页面，需要实现的功能：
1、顶部headers提示当前页面功能
2、显示需要审批的车辆列表，该车辆列表是使用做好的车辆卡片组件去实现。
3、底部不显示任何按钮
4、点击卡片时这次不去跳转到详情页，需要跳转到车辆修改页中，车辆修改页目前只设计一个占位就行，不实现具体功能。
4.1 车辆修改页因为是多个操作需要跳转的复用页面，需要考虑跳转到该页面，如何展示不同内容，包含的操作有：
4.1.1 新增车辆：点击新增车辆按钮，跳转到车辆发布页，车辆发布页目前只设计一个占位就行，不实现具体功能。
4.1.2 编辑车辆：点击编辑车辆按钮，跳转到车辆修改页，车辆修改页目前只设计一个占位就行，不实现具体功能。
4.1.3 审批车辆：点击审批车辆按钮，跳转到车辆审批页，车辆审批页目前只设计一个占位就行，不实现具体功能。
4.1.4 因为新增，编辑，审批功能基本内容，考虑如何在跳转后，让车辆修改页知道当前是新增还是编辑还是审批模式。
5、需要下拉刷新功能

#### 我要卖车页面功能实现

##### 卖车页面UI优化

1、在不改变原有组件实现的基础上，需要完成：
1.1 car-card组件，在零售价这一行的中间需要添加当前车辆状态的显示：

- 在后端给的字段中包含：
status：状态的value值
statusName：状态的name值
可能得status与statusName字段的value值对应关系如下：
枚举值
WAIT_APPROVE：待审批
WAIT_RECTIFY：待整改
ON_SALE：在售
SOLD：已出售
显示卡片当前车辆状态需要使用Vant的icon组件进行徽标，徽标在状态文字的左侧只显示对应状态的颜色显示：
- 待审批：warning
- 待整改：processing
- 在售：success
- 已出售：default

1.2 车辆列表UI优化：
车辆列表本身不做改动，只是需要在列表上方加一个下拉菜单，该菜单主要是用于根据下拉菜单选择的状态，对车辆列表的卡片进行状态过滤。主要的下拉选项有：

- 全部：显示全部车辆，默认选项，不进行过滤
- 待审批：显示待审批的车辆
- 待整改：显示待整改的车辆
- 在售：显示在售的车辆
- 已出售：显示已出售的车辆
在进行下拉菜单切换后，需要根据当前需要显示的状态进行车辆列表的重新查询

##### 新建车辆

新建车辆入口：在卖车列表页面点击新建车辆按钮，跳转到车辆发布页。该功能已实现，本次需求只是完成car-form页面的UI编写，不涉及功能逻辑的实现。
car-form页面的表单项包括：
分模块为两部分：1、车辆信息；2、售卖信息
1、车辆信息

- 车辆名称：输入框；placeholder：请输入
- 品牌车型：输入框；placeholder：请输入
- 车龄：数字输入框；placeholder：请输入，单位：年
- 颜色：输入框；placeholder：请输入
- 里程：数字输入框；placeholder：请输入，单位：万公里
- 过户次数：数字输入框；placeholder：请输入，整数
- 上牌日期：日期选择器；placeholder：请选择
- 上牌城市：输入框；placeholder：请输入
- 使用性质：输入框；placeholder：请输入
- 车况描述：文本输入框；placeholder：请输入，最大200字
- 加装项目：文本输入框；placeholder：请输入，最大200字
- 照片资料：图片上传；最大上传数量：5张；

2、售卖信息

- 底价：数字输入框；placeholder：请输入，单位：万元，保留两位小数
- 售价：数字输入框；placeholder：请输入，单位：万元，保留两位小数
- 联系方式：输入框：placeholder：请输入

底部按钮：提交，提交按钮，将数据进行后端服务保存。

##### 车型选择器公共组件建设

在新建页面中使用车型表单项，但是车型是一个较为复杂的表单选择器，而且多个地方都会使用，因此要先设计为一个单独的公共组件，方便其他页面使用。
组件需求：
1、车型选择器数据来源自后端，目前可以设计一些mock数据用于模拟数据展示。
2、车型选择器只支持单选
3、UI设计：
整体样式是一种外卖平台点单风格，左侧是菜单是显示当前的车辆品牌，右侧是滚动列表, 需要分组显示当前品牌下某车系的所有车型。因此右侧需要按车系分组显示车型。
在选择后，将选择的车系与款式使用函数进行回调，回调的文本结果："车系 款式"；还需要选择的车型的型号id。
4、逻辑设计，该公共组件和picker的显示方式类似，需要调用方告知何时显示，还需要注册一个隐藏事件，用于告知调用方该关闭显示了，触发时机是用户选择了款式后，选择器关闭。
5、整体逻辑：使用时整体如picker一般进行引入，绑定相关事件与显隐props，等待调用方控制显示；需要显示时，全屏遮罩显示车型选择器，选择完成后，将选择结果返回给调用方，并关闭选择器。

##### 编辑车辆

编辑车辆入口：在卖车列表页面点击车辆列表某车辆卡片，跳转到车辆修改页。该功能已实现，本次需求只是完成car-form页面的UI编写，不涉及功能逻辑的实现。

#### 接口对接

##### 用户详情

用处：登录完成，查询当前用户的详情

- url:/api/mp/user/query-user-profile
- method:GET
- 请求参数：无
- 返回参数：

```
/**
 * ApiResultMpUserDTO
 */
export interface Response {
    code?: string;
    data?: MpUserDTO;
    message?: string; // '200'为成功
    timestamp?: number;
    traceId?: string;
    [property: string]: any;
}

/**
 * MpUserDTO
 */
export interface MpUserDTO {
    /**
     * 小程序操作权限key数组，无权限时为null，如果不存在平台账号时为null。
     */
    miniProgramPermList?: string[];
    /**
     * 姓名，如果不存在平台账号时为null。
     */
    name?: string;
    /**
     * 手机号，一定不为null。
     */
    phone?: string;
    /**
     * 角色ID，如果null就没有任何权限。如果不存在平台账号时为null。
     */
    roleId?: number;
    /**
     * 角色名称，如果不存在平台账号时为null。
     */
    roleName?: string;
    /**
     * Web用户ID，如果不存在平台账号时为null。
     */
    userId?: number;
    [property: string]: any;
}
```

#### 权限功能对接

在profile页面中，需要使用到获取用户详情接口返回的权限字段：miniProgramPermList

- miniProgramPermList：小程序操作权限key数组，无权限时可能为null或者[]。可能得数据项：

- "miniprogram:page.teach"：profile页面：模拟票助考按钮权限
- "miniprogram:page.check"：profile页面：模拟票核销按钮权限
- "miniprogram:page.sell"：profile页面：我要卖车按钮权限
- "miniprogram:page.sell:action.add"：car-selling页面，新建车辆按钮权限
- "miniprogram:page.sell:action.edit"：暂无绑定对象，后续添加
- "miniprogram:page.sell:action.delete"：car-selling页面，删除按钮权限
- "miniprogram:page.approve"：profile页面：审批车辆按钮权限
- "miniprogram:page.approve:action.approve"：暂无绑定对象，后续添加
- "miniprogram:page.approve:action.edit"：暂无绑定对象，后续添加
- "miniprogram:page.approve:action.delete"：暂无绑定对象，后续添加
- "miniprogram:action.view-floor-price"：暂无绑定对象，后续添加

需要设计一个按钮权限组件，用于判断当前用户是否有权限显示按钮。如果有则根据传入的权限值显示按钮，如果没有则不显示按钮。
在miniProgramPermList
获取成功后，是存储在本地的，校验是从本地获取全部权限值，然后根据传入的权限值进行判断，是否显示按钮等内容

#### 编辑车辆功能

1、编辑车辆入口：在卖车列表页面点击车辆列表某车辆卡片，跳转到车辆修改页。
跳转逻辑：
1、需要携带当前mode为修改编辑模式的类型，需要携带当前车辆id
2、跳转页面完成后，判断当前如果是编辑模式，则根据车辆id查询车辆详情，并回显到表单中

车辆详情接口：

- url:/api/mp/car/query-car-detail
- method:GET
- 请求参数：carId
- 返回参数：

```
/**
 * 车辆详情信息
 *
 * ApiResultMpCarDetailResponse
 */
export interface Response {
    code?: string;
    data?: MpCarDetailResponse;
    message?: string;
    timestamp?: number;
    traceId?: string;
    [property: string]: any;
}

/**
 * MpCarDetailResponse
 */
export interface MpCarDetailResponse {
    /**
     * 车辆基本信息
     */
    basicInfo?: MpCarResponse;
    /**
     * 车型核心参数
     */
    modelInfo?: CarModelResponse;
    /**
     * 车辆名称
     */
    name?: string;
    [property: string]: any;
}

/**
 * 车辆基本信息
 *
 * MpCarResponse
 */
export interface MpCarResponse {
    /**
     * 车龄（年）
     */
    age?: number;
    /**
     * 审批意见
     */
    approveRemark?: string;
    /**
     * 审批时间
     */
    approveTime?: string;
    /**
     * 审批人ID
     */
    approveUserId?: number;
    /**
     * 审批人姓名
     */
    approveUserName?: string;
    /**
     * 品牌
     */
    brand?: string;
    /**
     * 颜色
     */
    color?: string;
    /**
     * 联系电话
     */
    contactPhone?: string;
    /**
     * 成交价格（万元）,保留2位小数
     */
    dealPrice?: number;
    /**
     * 成交时间
     */
    dealTime?: string;
    /**
     * 收藏状态：FAVORITE-已收藏，NOT_FAVORITE-未收藏
     */
    favorStatus?: FavorStatus;
    /**
     * 收藏时间
     */
    favorTime?: string;
    /**
     * 底价（万元）,保留2位小数
     */
    floorPrice?: number;
    /**
     * 车辆ID
     */
    id?: number;
    /**
     * 图片文件ID列表，逗号分隔
     */
    imageFileIds?: string;
    /**
     * 图片url列表，每个元素包含文件名和文件url，用于预览图片
     */
    imageUrlList?: FileUrlInfo[];
    /**
     * 上牌城市
     */
    licenseCity?: string;
    /**
     * 上牌日期，yyyy-MM-dd
     */
    licenseDate?: string;
    /**
     * 里程（万公里）,保留2位小数
     */
    mileage?: number;
    /**
     * 车型ID
     */
    modelId?: number;
    /**
     * 加装项目
     */
    modifyItems?: string;
    /**
     * 车辆名称
     */
    name?: string;
    /**
     * 发布时间
     */
    publishTime?: string;
    /**
     * 发布人ID
     */
    publishUserId?: number;
    /**
     * 发布人姓名
     */
    publishUserName?: string;
    /**
     * 车况描述
     */
    remark?: string;
    /**
     * 售价（万元）,保留2位小数
     */
    sellPrice?: number;
    /**
     * 出售人ID
     */
    sellUserId?: number;
    /**
     * 出售人姓名
     */
    sellUserName?: string;
    /**
     * 车系
     */
    series?: string;
    /**
     * 车辆状态
     */
    status?: Status;
    /**
     * 车辆状态名称
     */
    statusName?: string;
    /**
     * 过户次数
     */
    transferCount?: number;
    /**
     * 使用性质
     */
    usage?: string;
    /**
     * 款式
     */
    variant?: string;
    [property: string]: any;
}

/**
 * 收藏状态：FAVORITE-已收藏，NOT_FAVORITE-未收藏
 */
export enum FavorStatus {
    Favorite = "FAVORITE",
    NotFavorite = "NOT_FAVORITE",
}

/**
 * FileUrlInfo
 */
export interface FileUrlInfo {
    /**
     * 文件名, 上传到cos后的文件名，格式：logo/uuid.ext，或者car/uuid.ext
     * 例如：logo/1234567890.png, car/1234567890.png
     */
    fileName?: string;
    /**
     * 文件url，可以直接预览图片。
     */
    fileUrl?: string;
    [property: string]: any;
}

/**
 * 车辆状态
 */
export enum Status {
    OnSale = "ON_SALE",
    Sold = "SOLD",
    WaitApprove = "WAIT_APPROVE",
    WaitRectify = "WAIT_RECTIFY",
}

/**
 * 车型核心参数
 *
 * CarModelResponse
 */
export interface CarModelResponse {
    /**
     * 电池容量（kWh）
     */
    batteryCapacity?: string;
    /**
     * 电池类型
     */
    batteryType?: string;
    /**
     * 车身结构
     */
    bodyStructure?: string;
    /**
     * 品牌
     */
    brand?: string;
    /**
     * 综合续航（公里）
     */
    comprehensiveRange?: number;
    /**
     * 创建时间
     */
    createTime?: string;
    /**
     * 创建人ID
     */
    createUserId?: number;
    /**
     * 创建人姓名
     */
    createUserName?: string;
    /**
     * 排量（L）,如：2.0L,1.5T等。
     */
    displacement?: string;
    /**
     * 驱动方式
     */
    driveType?: string;
    /**
     * 能源类型
     */
    energyType?: string;
    /**
     * 新车指导价（万元）,保留2位小数
     */
    guidePrice?: number;
    /**
     * 车型ID
     */
    id?: number;
    /**
     * 品牌logo文件ID
     */
    logoFileId?: string;
    /**
     * 品牌logo图片url
     */
    logoUrl?: string;
    /**
     * 驱动电机数
     */
    motorCount?: number;
    /**
     * 电动机马力（PS）
     */
    motorPower?: string;
    /**
     * 纯电续航（公里）
     */
    pureElectricRange?: number;
    /**
     * 座位数
     */
    seatCount?: number;
    /**
     * 车系
     */
    series?: string;
    /**
     * 变速箱类型
     */
    transmissionType?: string;
    /**
     * 更新时间
     */
    updateTime?: string;
    /**
     * 更新人ID
     */
    updateUserId?: number;
    /**
     * 更新人姓名
     */
    updateUserName?: string;
    /**
     * 款式
     */
    variant?: string;
    [property: string]: any;
}
```

图片回显逻辑：需要使用接口返回的imageFileIds字段，每一个fileUrl都是一个可预览的图片地址，回显的图片需要添加标识，表示是已上传的图片，不能在保存时重新添加到上传队列中。

#### 审批车辆

在审批车辆列表页面，点击车辆卡片，需要跳转到车辆审批页面（car-form页面），需要设置mode类型为审批模式，携带车辆id参数，在跳转到car-form后，需要根据id查询详情，这一点在之前编辑车辆时完成了，直接进行复用即可。与编辑车辆不同点：
1、title显示“审批车辆”
2、底部按钮需要显示为：通过，驳回
3、通过与驳回都要调用同一个审批接口，只是参数不同，APPROVED-通过，REJECTED-驳回
4、在表单项需要新增必填表单项：
审批意见：textarea，最大200字符，允许清除，placeholder：请输入；绑定的filed为approveRemark

#### 车源页面需求

1、页面入口：tabBar中点击车源
2、页面功能：提供用户一个查询在售车辆信息的页面，方便用户根据一些条件进行车辆信息的筛选，包括：

- 关键词搜索：默认为空，placeholder：“品牌/车龄/价位等”
- 排序方式
包含的排序方式：一个下拉框：包含的下拉选项：
- LATEST_PUBLISHED-最新上架，LOWEST_PRICE-价格最低，HIGHEST_PRICE-价格最高，SHORTEST_AGE-车龄最短，SMART-智能排序。默认：车龄最短，SMART。

- 品牌车型:使用vehicle-picker组件
- 车龄筛选：一个下拉面板，面板提供一些默认单选选项按钮，包括：
  - 不限
  - 1年以内
  - 3年以内
  - 5年以内
  - 10年以内
  - 1-3年
  - 3-5年
  - 5-10年
  - 10年以上
 在默认单选按钮下发给出输入范围的表单项：
 title：自定义车龄
 左右两个输入框，中间“-”符号连接，示意：

 --------------------------------
 ---------------        ---------

| -最低车龄---|-   -   |--最高车龄-|
 --------------------------------

- 价格筛选：一个下拉面板，面板提供一些默认单选选项按钮，包括：
  - 不限
  - 1万以下
  - 5万以下
  - 5-10万
  - 10-15万
  - 15-20万
  - 20万以上

 在默认单选按钮下发给出输入范围的表单项：
 title：自定义价格，左侧为最低价格输入表单项，右侧为最高价格输入表单项。

UI大致示意：

---------------------------------

模糊搜索框
---------------------------------

排序方式|品牌车型|车龄筛选|价格筛选
---------------------------------

回显除排序方式外的筛选项
---------------------------------

车辆列表

---------------------------------

要点说明：本次实现只完成UI开发，不包含车辆列表查询接口的实现

##### 功能优化

- brandTitle固定显示：“品牌”
- ageTitle固定显示：“车龄”
- priceTitle固定显示：“价格”

品牌需要调整，品牌下拉的UI样式和其他筛选字段一样，但更类似与按钮，点击后不显示下拉面板，而是直接显示vehicle-picker组件的弹窗，使用方式可参考car-form页面的品牌选择。
